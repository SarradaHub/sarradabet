name: Coverage Badge

on:
  push:
    branches: [main, develop]
  workflow_dispatch:

jobs:
  coverage:
    uses: SarradaHub/platform/.github/workflows/coverage-badge.yaml@main
    with:
      node-version: '20'
      working-directory: .
      install-command: npm ci
      test-command: npm run test:api:coverage && npm run test:web:coverage
      prisma-generate: true
      prisma-working-directory: apps/api
      prepare-db-command: cd apps/api && npm run prisma:migrate:deploy && npm run db:seed:simple
      postgres-db: sarradabet_test
      db-url: postgresql://postgres:postgres@localhost:5432/sarradabet_test
      coverage-paths: |
        apps/api/coverage
        apps/web/coverage
