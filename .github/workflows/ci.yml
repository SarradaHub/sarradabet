name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

permissions:
  contents: read
  pull-requests: read
  issues: read

jobs:
  ci:
    permissions:
      contents: read
      pull-requests: read
      issues: read
    uses: SarradaHub/platform/.github/workflows/node-monorepo-ci.yaml@main
    with:
      working-directory: .
      node-version: '20'
      install-command: npm ci
      lint-command: npm run lint
      typecheck-command: npm run check-types
      build-command: npm run build
      prisma-generate: true
      prisma-working-directory: apps/api
      prepare-db-command: npm run build:design-system && cd apps/api && npm run prisma:migrate:deploy && npm run db:seed:simple
      test-api-command: npm run test:api:coverage
      test-web-command: npm run test:web:coverage
      postgres-db: sarradabet_test
      db-url: postgresql://postgres:postgres@localhost:5432/sarradabet_test
      coverage-artifacts: true
